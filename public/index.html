
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title> 
     Good Reads Books

    </title>

    <link rel="icon" href="">
    
    <link href="https://fonts.googleapis.com/css?family=Montserrat|Quicksand|Roboto+Condensed|Ubuntu" rel="stylesheet">
    <!-- Font -->
    <!-- Bootstrap Core CSS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    
    
 
    
    <!-- Latest compiled and minified CSS -->




        <style>
        h1,h2,h3,h4,h5,h6,th,.qs-font *{
          font-family: 'Quicksand', sans-serif;
      }

       table,tr,td, .roboto-font *{
        font-family: 'Roboto Condensed', sans-serif;
      }

      li a, ul a,.navbar-brand .brand-name,.btn,button,.form-control,textarea,select, .ubuntu-font *{
      font-family: 'Ubuntu', sans-serif;
      }

      p,a,div,span,button,form,label,input,textarea,img,.ms-font *{
        font-family: 'Montserrat', sans-serif;
      }

    
      </style>
        
  </head>

  <body>
  
       


<div class="container mb-2 p-4">
    <div class="row">

      <div class="col-md-12">
          <h1 class="display-4 text-secondary"> GoodReads search </h1>
         <hr>

      </div>
  </div>
</div>


<div class="container">
   
    
        

				<div class="row">
          
          <div class="col-md-12">
            


           
		<div class="p-4 bg-light rounded-pill">
			<form action="/api/v1/search" method="get">

					<div class="row">
						
						<div class="col-md-7">
							
							<input type="text"  name="q" class="form-control rounded-pill searchInput" value="" placeholder="Search Books">
							
						</div>
            <div class="col-md-3">
                <select class="form-control rounded-pill filterInput" name="filter" id="sel1">

                    <option value="all">Sort By (All)</option>
                    <option value="date-asc">Date (Oldest First)</option>
                    <option value="date-desc">Date (Newest First)</option>
                    <option value="author-asc">Author (ASC)</option>
                    <option value="author-desc">Author (DESC)</option>
                    <option value="rating-asc">rating (Low-High) </option>
                    <option value="rating-desc">rating (High-low)</option>
                    <option value="title-asc">title (ASC)</option>
                    <option value="title-desc">title (DESC)</option>
                
                </select>
            </div>

						<div class="col-md-2">

								<button type="submit" class="btn btn-success ajax-submit btn-block rounded-pill stretch mr-10">
									<i class="fa fa-search" aria-hidden="true"></i></button>
							

						</div>

					</div>		

				</form>
			</div>

      <p class="ajax-message mt-2"></p>

      
      <div class="row">
          <div class="col-md-12 return-container ">
            </div>
      </div>

  



          </div>				
				</div>	
    
  </div>
  <hr>


    <!-- app download -->


    <!-- footer -->
    <footer>
            <div class="container">
                
                <div class="row">
          
                      <div class="col-md-6 col-xs-12">

                          <span class="navbar-text roboto-font text-center mb-2">
                              <p>&copy; 2019 <strong>Good Reads Search</strong></p>
                          </span>
                       
                      </div>
                  
                    
                    
                  </div>

            </div>
    </div>

      <!-- /credit -->
    </footer>
    <!-- /footer -->


 <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <!-- jQuery library --> <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" ></script>
    
     <script src="http://malsup.github.com/jquery.form.js"></script>
    <script>
function e(str) {
    return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}

function rating(avr_rating)
{
  var avr = Math.floor(avr_rating);
  var checkedStar = '<span class="fa fa-star text-warning"></span>';
  var uncheckedStar = '<span class="fa fa-star text-dark"></span>';
  let checkedStarIcons = '';
  let uncheckedStarIcons = '';

  checkedStarIcons = checkedStar.repeat(avr);
  if(avr < 5)
  {
    uncheckedStarIcons = uncheckedStar.repeat((5 - avr));
  }

    return checkedStarIcons + uncheckedStarIcons  ;

}
function card(id,thumbnail,title,author,pubDate,average_rating,ratings_count,books_count,text_reviews_count)
{
  return `   <div class="media pb-1 pt-1 align-middle  wow fadeIn">
                                                    <a href="/ebook/${id}" class="mt-0">
                                                    <img class="mr-4 shadow" height="150" width="130"   src="${thumbnail}" alt="INTRODUCTION TO ANKARA CRAFTS">
                                                    </a>
                                                    <div class="media-body">
                                                    <h3 class="mt-md-2 ubuntu-font ">
                                                    <a href="/ebook/${id}"  class="text-danger"><strong>${title}</strong></a>
                                                    </h3>
                                                    <h5 class="text-secondary mt-3">
                                                    <strong>
                                                        <span class="badge badge-light rounded-pill p-2 pl-3 pr-3" title="Books in stock  ${books_count} ">  
                                                       <i class="fa fa-book"></i> ${books_count} </span>
                                                    <span class="badge badge-light rounded-pill p-2 pl-3 pr-3">  
                                                       <i class="fa fa-user-circle"></i> ${author} </span>
                                                    <span class="badge badge-light text-secondary rounded-pill p-2 pl-3 pr-3 mt-sm-2"> 
                                                         <i class="fa fa-calendar"></i> ${pubDate} </span>
                                                    </strong>
                                                    </h5>

                                                    <h6 class="text-secondary mt-3">
                                                    <strong>
                                                        <span title="${average_rating}">
                                                    ${rating(average_rating)} (${ratings_count})
                                                    </span>

                                                    <span class="badge badge-light text-secondary rounded-pill py-1 px mt-sm-2"> 
                                                         <i class="fa fa-comments"></i> ${text_reviews_count} reviews </span>
                                                    </strong>
                                                    </h6>

                                                    </div>
                                                    </div>
                                                    <hr>`;
}

function ajax_message(type,message)
{
  return `<div class="alert alert-${type} alert-dismissible fade show rounded-pill" role="alert"><i class="fa fa-check-circle"></i> 
    ${message}   <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>`;
}

function  send_form_data(form_object,load_container, return_container,load_selector)
 {
        form_object.ajaxSubmit({
                        dataType: 'json',
                       data: form_object.serialize,
                       beforeSend: function()
                                  {
                                     $(load_container).html(load_selector);
                                   },
                       complete:function(){ },
                       success:function(data)
                              {
                                let bookList = [] ;
                                let bookCount = 0 ;

                                if(data.response.returnData.length > 0)
                                {
                                    bookList = data.response.returnData ;
                                    bookCount = bookList.length;

                                 
                                    
                                }
                                let searchString = data.response.queryString;
                                let filter = $('.filterInput option:selected').text();

                                let ajaxMSG =  ajax_message('success',`<strong>${bookCount} results</strong> 
                                found for your search <strong>"${searchString}"</strong> 
                                filter: <strong>"${filter}"</strong>` );

                                if(bookCount < 1)
                                {
                                  ajaxMSG =  ajax_message('warning',`No results found for your search <strong>"${searchString}"</strong>` );                            
                                }

                                $(load_container).html(ajaxMSG);

                                var return_html = '<hr>';


                                bookList.forEach(function(index) {
    
                                  
                                        // your other stuff goes here
                                  var id = index.id.$t;
                                  var title = e(index.best_book.title);
                                  var average_rating = index.average_rating;
                                  var ratings_count = index.ratings_count.$t;
                                  var books_count = index.books_count.$t;
                                  var text_reviews_count = index.text_reviews_count.$t;
                                  var author = index.best_book.author.name;
                                  var thumbnail = index.best_book.image_url;
                                  var pubDay = typeof  index.original_publication_day.$t != 'undefined' ? index.original_publication_day.$t+ ' / '  : '';
                                  var pubMonth = typeof  index.original_publication_month.$t != 'undefined' ? index.original_publication_month.$t+ ' / '  : '';
                                  var pubYear = typeof  index.original_publication_year.$t != 'undefined' ? index.original_publication_year.$t  : '';
                                 
                                  var pubDate = pubDay + pubMonth + pubYear ;


                                  return_html += card(id,thumbnail,title,author,pubDate,average_rating,ratings_count,books_count,text_reviews_count);

                                });


                                $(return_container).html(return_html);
                                
                                console.log(data);



                              },

                       error:function()
                              {
                                $(load_container).html(ajax_message('warning',`Please check your internet connection and try again` ));

                                 
                               }

                      });


 }

    $(function () {
    var $loading_circle = '<center><div class="spinner-border" role="status"><span class="sr-only">Loading...</span></div></center>';
   
    $('body').on('click','.ajax-submit',
    function (e)
    {
      var $form = $(this).parents('form');
       e.preventDefault();
      send_form_data($form, '.ajax-message','.return-container', $loading_circle);


    });

    $('body').on('change','.filterInput',
    function (e)
    {
      var $form = $(this).parents('form');
       e.preventDefault();
      send_form_data($form, '.ajax-message','.return-container', $loading_circle);


    });
   });
    </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    
  </body>
</html>
